---
title: "Transfer users data"
author: 
- Damiano Oldoni
date: "`r Sys.Date()`"
output:
  html_document:
    toc: true
    toc_depth: 3
    toc_float: true
    number_sections: true
    theme: yeti
    df_print: paged
knit: (function(input_file, encoding) { rmarkdown::render(input_file, encoding = encoding, output_file = paste0("../docs/",sub(".Rmd", ".html", basename(input_file))))})
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
```

# Goal

This pipeline will:

1. extract data from INBO *kleurring* database
2. transform data to SOVON format
3. write data in a text file

# Install and load libraries

Install `sovon` package:

```{r install_sovon_package, eval = FALSE}
devtools::install_github("damianooldoni/sovon")
```

Load libraries:

```{r load_libraries, eval = FALSE}
library(sovon)
library(readr)
```

Connect to INBO *kleurring* database:

```{r connect_to_db, eval = FALSE}
conn <- sovon::connect_to_kleurring()
```

# Extract user data from INBO database

First, we extract data about users from INBO *kleurring* database:

```{r get_user_data, eval = FALSE}
INBO_users <- sovon::get_users(conn)
```

For privcay reasons no preview is shown. How many users do we get?

```{r number_users, eval = FALSE}
nrow(INBO_users)
```


# Transform user data 

Next step is transforming user data to SOVON format. For more info see spreadsheet [here](https://drive.google.com/drive/folders/1GoPXDluxdviHEZIRcInmLwSHDqkTrmsM).

```{r transform_to_SOVON_format, eval = FALSE}
INBO_users <- sovon::transform_users(INBO_users)
```

For privcay reasons data are not shown.

# Export data in text file

The user data are ready for being written in a text file (comma separated value)

```{r write_user_data_txt, eval = FALSE}
readr::write_csv(INBO_users, path = "../data/output/data_users.tsv", na = "")
```
